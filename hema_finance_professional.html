<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Management System - HEMA Higher Secondary School</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-blue: #4A90E2;
            --primary-green: #4CAF50;
            --primary-red: #FF5252;
            --primary-yellow: #FFC107;
            --text-dark: #2C3E50;
            --text-light: #95A5A6;
            --bg-light: #F5F7FA;
            --white: #FFFFFF;
            --border: #E0E6ED;
            --shadow: 0 2px 10px rgba(0,0,0,0.08);
            --shadow-hover: 0 4px 20px rgba(0,0,0,0.12);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: var(--white);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 30px;
            border-bottom: 1px solid var(--border);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #4A90E2 0%, #5CB3FF 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 22px;
        }

        .school-name h1 {
            font-size: 18px;
            color: var(--primary-blue);
            font-weight: 700;
            margin: 0;
        }

        .school-name p {
            font-size: 12px;
            color: var(--text-light);
            margin: 0;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .session-select {
            padding: 8px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background: var(--white);
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.3s;
        }

        .session-select:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .search-container {
            position: relative;
            flex: 1;
            max-width: 600px;
            margin: 0 30px;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: var(--white);
            padding: 0 30px;
            overflow-x: auto;
            border-bottom: 1px solid var(--border);
        }

        .nav-tab {
            padding: 15px 25px;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab:hover {
            color: var(--primary-blue);
        }

        .nav-tab.active {
            color: var(--primary-blue);
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-blue);
            border-radius: 3px 3px 0 0;
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            border-left: 4px solid;
            position: relative;
        }

        .stat-card:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        .stat-card.blue { border-left-color: var(--primary-blue); }
        .stat-card.green { border-left-color: var(--primary-green); }
        .stat-card.red { border-left-color: var(--primary-red); }
        .stat-card.yellow { border-left-color: var(--primary-yellow); }

        .stat-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .stat-card.blue .stat-icon { 
            background: rgba(74, 144, 226, 0.1); 
            color: var(--primary-blue);
        }
        .stat-card.green .stat-icon { 
            background: rgba(76, 175, 80, 0.1); 
            color: var(--primary-green);
        }
        .stat-card.red .stat-icon { 
            background: rgba(255, 82, 82, 0.1); 
            color: var(--primary-red);
        }
        .stat-card.yellow .stat-icon { 
            background: rgba(255, 193, 7, 0.1); 
            color: var(--primary-yellow);
        }

        .stat-content {
            flex: 1;
        }

        .stat-title {
            font-size: 12px;
            color: var(--text-light);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .stat-subtitle {
            font-size: 13px;
            color: var(--text-light);
        }

        /* Form Card */
        .form-card {
            background: var(--white);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .form-card h2 {
            font-size: 20px;
            color: var(--text-dark);
            margin-bottom: 25px;
            font-weight: 700;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .form-label.required::after {
            content: '*';
            color: var(--primary-red);
            margin-left: 4px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
            background: var(--white);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .btn-primary {
            background: var(--primary-blue);
            color: var(--white);
        }

        .btn-success {
            background: var(--primary-green);
            color: var(--white);
        }

        .btn-danger {
            background: var(--primary-red);
            color: var(--white);
        }

        .btn-secondary {
            background: var(--text-light);
            color: var(--white);
        }

        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* Table */
        .table-container {
            background: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .table-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .table-header h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            background: var(--bg-light);
        }

        .data-table th {
            padding: 15px 20px;
            text-align: left;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-dark);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border);
        }

        .data-table td {
            padding: 15px 20px;
            font-size: 14px;
            color: var(--text-dark);
            border-bottom: 1px solid var(--border);
        }

        .data-table tbody tr {
            transition: all 0.2s;
        }

        .data-table tbody tr:hover {
            background: var(--bg-light);
        }

        /* Action Buttons */
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin: 0 3px;
        }

        .action-btn.edit {
            background: rgba(0, 188, 212, 0.1);
            color: #00BCD4;
        }

        .action-btn.delete {
            background: rgba(255, 82, 82, 0.1);
            color: var(--primary-red);
        }

        /* Filter Bar */
        .filter-bar {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }

        /* Alert */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            font-weight: 500;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .alert.show {
            display: flex;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert-success {
            background: rgba(76, 175, 80, 0.1);
            color: var(--primary-green);
            border-left: 4px solid var(--primary-green);
        }

        .alert-danger {
            background: rgba(255, 82, 82, 0.1);
            color: var(--primary-red);
            border-left: 4px solid var(--primary-red);
        }

        /* TDS Box */
        .tds-box {
            background: var(--bg-light);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .tds-box h4 {
            font-size: 15px;
            color: var(--text-dark);
            margin-bottom: 15px;
            font-weight: 700;
        }

        .tds-result {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .tds-item {
            background: var(--white);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid var(--primary-blue);
        }

        .tds-label {
            font-size: 12px;
            color: var(--text-light);
            font-weight: 600;
            text-transform: uppercase;
        }

        .tds-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-blue);
            margin-top: 5px;
        }

        /* Import Area */
        .import-area {
            background: var(--white);
            border: 3px dashed var(--border);
            border-radius: 12px;
            padding: 50px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s;
        }

        .import-area:hover {
            border-color: var(--primary-blue);
            background: rgba(74, 144, 226, 0.02);
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 12px 30px;
            background: var(--primary-blue);
            color: var(--white);
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-label:hover {
            background: #3A7BC8;
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        /* Stats Info */
        .stats-info {
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .stats-info h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 20px;
        }

        .stats-info-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .stats-info-item:last-child {
            border-bottom: none;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(76, 175, 80, 0.1);
            color: var(--primary-green);
        }

        .badge-warning {
            background: rgba(255, 193, 7, 0.1);
            color: var(--primary-yellow);
        }

        .badge-danger {
            background: rgba(255, 82, 82, 0.1);
            color: var(--primary-red);
        }

        /* FAB */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--primary-blue);
            color: var(--white);
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(74, 144, 226, 0.4);
            transition: all 0.3s;
            z-index: 999;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(74, 144, 226, 0.6);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .filter-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header-top {
                flex-direction: column;
                gap: 15px;
            }

            .search-container {
                margin: 0;
                max-width: 100%;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="logo-section">
                <div class="logo">H</div>
                <div class="school-name">
                    <h1>HEMA HIGHER SECONDARY SCHOOL</h1>
                    <p>Finance Management System</p>
                </div>
            </div>

            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search by party name, work description, amount..." id="globalSearch">
                <span class="search-icon"><i class="fas fa-search"></i></span>
            </div>

            <div class="header-actions">
                <select class="session-select" id="sessionSelect">
                    <option value="2025-2026">Session: 2025 - 2026</option>
                    <option value="2024-2025">Session: 2024 - 2025</option>
                    <option value="2023-2024">Session: 2023 - 2024</option>
                </select>
            </div>
        </div>

        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">
                <i class="fas fa-chart-line"></i> Dashboard
            </button>
            <button class="nav-tab" onclick="switchTab('add')">
                <i class="fas fa-plus-circle"></i> Add Record
            </button>
            <button class="nav-tab" onclick="switchTab('view')">
                <i class="fas fa-table"></i> View All Records
            </button>
            <button class="nav-tab" onclick="switchTab('import')">
                <i class="fas fa-file-import"></i> Import/Export
            </button>
        </nav>
    </header>

    <!-- Main Container -->
    <div class="container">
        <div id="alertBox" class="alert"></div>

        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section active">
            <div class="stats-grid">
                <div class="stat-card blue">
                    <div class="stat-header">
                        <div class="stat-content">
                            <div class="stat-title">Total Bills</div>
                            <div class="stat-value" id="totalBillsAmount">₹0.00</div>
                            <div class="stat-subtitle">Overall bill amount</div>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                    </div>
                </div>

                <div class="stat-card green">
                    <div class="stat-header">
                        <div class="stat-content">
                            <div class="stat-title">Total Paid</div>
                            <div class="stat-value" id="totalPaidAmount">₹0.00</div>
                            <div class="stat-subtitle">Amount received</div>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                </div>

                <div class="stat-card red">
                    <div class="stat-header">
                        <div class="stat-content">
                            <div class="stat-title">Outstanding</div>
                            <div class="stat-value" id="outstandingAmount">₹0.00</div>
                            <div class="stat-subtitle">Balance pending</div>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                    </div>
                </div>

                <div class="stat-card yellow">
                    <div class="stat-header">
                        <div class="stat-content">
                            <div class="stat-title">Total Records</div>
                            <div class="stat-value" id="totalRecordsCount">0</div>
                            <div class="stat-subtitle">Financial entries</div>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-file-invoice"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <h3>Recent Transactions</h3>
                    <button class="btn btn-primary" onclick="switchTab('add')">
                        <i class="fas fa-plus"></i> Add New
                    </button>
                </div>
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Party Name</th>
                                <th>Work Done</th>
                                <th>Bill Amount</th>
                                <th>Paid</th>
                                <th>Balance</th>
                                <th>Status</th>
                                <th>Due Date</th>
                            </tr>
                        </thead>
                        <tbody id="recentTable">
                            <tr>
                                <td colspan="7" style="text-align: center; color: var(--text-light); padding: 40px;">
                                    No records yet. Click "Add New" to create your first record.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Add Record Section -->
        <section id="add" class="content-section">
            <div class="form-card">
                <h2>Add New Financial Record</h2>
                <form id="financeForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label required">Party Name</label>
                            <input type="text" class="form-input" id="partyName" required placeholder="Enter vendor/party name">
                        </div>

                        <div class="form-group">
                            <label class="form-label required">Work Done</label>
                            <input type="text" class="form-input" id="workDone" required placeholder="Description of service">
                        </div>

                        <div class="form-group">
                            <label class="form-label required">Bill Date</label>
                            <input type="date" class="form-input" id="billDate" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">Overall Bill Amount (₹)</label>
                            <input type="number" class="form-input" id="billAmount" required step="0.01" placeholder="0.00" oninput="calculateTDS()">
                        </div>

                        <div class="form-group">
                            <label class="form-label">TDS Rate</label>
                            <select class="form-select" id="tdsRate" onchange="calculateTDS()">
                                <option value="0">No TDS</option>
                                <option value="1">1% TDS</option>
                                <option value="2">2% TDS</option>
                                <option value="10">10% TDS</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">Total Payable (₹)</label>
                            <input type="number" class="form-input" id="totalPayable" required step="0.01" placeholder="0.00">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Total Paid Till Date (₹)</label>
                            <input type="number" class="form-input" id="paidTillDate" step="0.01" placeholder="0.00" value="0">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Payment Date</label>
                            <input type="date" class="form-input" id="paymentDate">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Balance to be Paid (₹)</label>
                            <input type="number" class="form-input" id="balanceToPay" step="0.01" placeholder="0.00">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Paid in January (₹)</label>
                            <input type="number" class="form-input" id="paidInJan" step="0.01" placeholder="0.00" value="0">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Due Date</label>
                            <input type="date" class="form-input" id="dueDate">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select class="form-select" id="category">
                                <option value="Lease Rent">Lease Rent</option>
                                <option value="Salary">Salary</option>
                                <option value="Vehicle Finance">Vehicle Finance</option>
                                <option value="Utilities">Utilities</option>
                                <option value="Repairs & Maintenance">Repairs & Maintenance</option>
                                <option value="AMC">AMC</option>
                                <option value="Printing">Printing</option>
                                <option value="Educational Services">Educational Services</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="tds-box">
                        <h4>TDS Calculation Preview</h4>
                        <div class="tds-result">
                            <div class="tds-item">
                                <div class="tds-label">TDS Amount</div>
                                <div class="tds-value" id="tdsAmountDisplay">₹0.00</div>
                            </div>
                            <div class="tds-item">
                                <div class="tds-label">Net Payable</div>
                                <div class="tds-value" id="netPayableDisplay">₹0.00</div>
                            </div>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Record
                        </button>
                        <button type="button" class="btn btn-success" onclick="saveAndNew()">
                            <i class="fas fa-plus"></i> Save & Add New
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">
                            <i class="fas fa-redo"></i> Reset Form
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- View Records Section -->
        <section id="view" class="content-section">
            <div class="filter-bar">
                <div class="filter-grid">
                    <div class="form-group">
                        <label class="form-label">Search</label>
                        <input type="text" class="form-input" id="searchInput" placeholder="Search records..." onkeyup="filterTable()">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select class="form-select" id="categoryFilter" onchange="filterTable()">
                            <option value="">All Categories</option>
                            <option value="Lease Rent">Lease Rent</option>
                            <option value="Salary">Salary</option>
                            <option value="Vehicle Finance">Vehicle Finance</option>
                            <option value="Utilities">Utilities</option>
                            <option value="Repairs & Maintenance">Repairs & Maintenance</option>
                            <option value="AMC">AMC</option>
                            <option value="Printing">Printing</option>
                            <option value="Educational Services">Educational Services</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Payment Status</label>
                        <select class="form-select" id="statusFilter" onchange="filterTable()">
                            <option value="">All Status</option>
                            <option value="paid">Fully Paid</option>
                            <option value="partial">Partially Paid</option>
                            <option value="unpaid">Unpaid</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" style="opacity: 0;">Action</label>
                        <button class="btn btn-secondary" onclick="clearAllFilters()">Clear Filters</button>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <h3>All Financial Records</h3>
                </div>
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Party Name</th>
                                <th>Work Done</th>
                                <th>Bill Date</th>
                                <th>Bill Amount</th>
                                <th>Paid</th>
                                <th>Balance</th>
                                <th>Due Date</th>
                                <th>Category</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recordsTable">
                            <tr>
                                <td colspan="11" style="text-align: center; color: var(--text-light); padding: 40px;">
                                    No records available
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Import/Export Section -->
        <section id="import" class="content-section">
            <div class="import-area">
                <div style="font-size: 48px; color: var(--primary-blue); margin-bottom: 15px;">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h3>Import Financial Data</h3>
                <p>Upload your existing finance report in Excel or CSV format</p>
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls,.csv" onchange="handleFileImport(event)">
                <label for="fileInput" class="file-label">
                    <i class="fas fa-file-upload"></i> Choose File
                </label>
                <p style="margin-top: 15px; font-size: 12px; color: var(--text-light);">
                    Supported formats: Excel (.xlsx, .xls) and CSV (.csv)
                </p>
            </div>

            <div class="btn-group">
                <button class="btn btn-success" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> Export to Excel
                </button>
                <button class="btn btn-primary" onclick="exportToCSV()">
                    <i class="fas fa-file-csv"></i> Export to CSV
                </button>
                <button class="btn btn-secondary" onclick="printData()">
                    <i class="fas fa-print"></i> Print Report
                </button>
                <button class="btn btn-danger" onclick="clearAllRecords()">
                    <i class="fas fa-trash-alt"></i> Clear All Data
                </button>
            </div>

            <div class="stats-info" style="margin-top: 30px;">
                <h3><i class="fas fa-chart-bar"></i> System Statistics</h3>
                <div class="stats-info-item">
                    <span style="color: var(--text-light); font-weight: 600;">Total Records Stored</span>
                    <span style="color: var(--text-dark); font-weight: 700;" id="statsRecords">0</span>
                </div>
                <div class="stats-info-item">
                    <span style="color: var(--text-light); font-weight: 600;">Last Updated</span>
                    <span style="color: var(--text-dark); font-weight: 700;" id="statsLastUpdate">Never</span>
                </div>
                <div class="stats-info-item">
                    <span style="color: var(--text-light); font-weight: 600;">Data Size</span>
                    <span style="color: var(--text-dark); font-weight: 700;" id="statsDataSize">0 KB</span>
                </div>
                <div class="stats-info-item">
                    <span style="color: var(--text-light); font-weight: 600;">Session</span>
                    <span style="color: var(--text-dark); font-weight: 700;">2025 - 2026</span>
                </div>
            </div>
        </section>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="switchTab('add')" title="Add New Record">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Include SheetJS Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        // Global variables
        let records = JSON.parse(localStorage.getItem('financeRecords')) || [];
        let editIndex = -1;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('billDate').valueAsDate = new Date();
            updateDashboard();
            displayRecords();
            updateStats();
        });

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'dashboard') updateDashboard();
            if (tabName === 'view') displayRecords();
            if (tabName === 'import') updateStats();
        }

        // Calculate TDS
        function calculateTDS() {
            const billAmt = parseFloat(document.getElementById('billAmount').value) || 0;
            const tdsRate = parseFloat(document.getElementById('tdsRate').value) || 0;

            const tdsAmt = (billAmt * tdsRate) / 100;
            const netPayable = billAmt - tdsAmt;

            document.getElementById('tdsAmountDisplay').textContent = `₹${tdsAmt.toFixed(2)}`;
            document.getElementById('netPayableDisplay').textContent = `₹${netPayable.toFixed(2)}`;
            document.getElementById('totalPayable').value = netPayable.toFixed(2);
        }

        // Form submission
        document.getElementById('financeForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const record = {
                id: editIndex >= 0 ? records[editIndex].id : Date.now(),
                partyName: document.getElementById('partyName').value,
                workDone: document.getElementById('workDone').value,
                billDate: document.getElementById('billDate').value,
                billAmount: parseFloat(document.getElementById('billAmount').value),
                tdsRate: parseFloat(document.getElementById('tdsRate').value) || 0,
                totalPayable: parseFloat(document.getElementById('totalPayable').value),
                paidTillDate: parseFloat(document.getElementById('paidTillDate').value) || 0,
                paymentDate: document.getElementById('paymentDate').value,
                balanceToPay: parseFloat(document.getElementById('balanceToPay').value) || 0,
                paidInJan: parseFloat(document.getElementById('paidInJan').value) || 0,
                dueDate: document.getElementById('dueDate').value,
                category: document.getElementById('category').value,
                timestamp: new Date().toISOString()
            };

            if (editIndex >= 0) {
                records[editIndex] = record;
                showAlert('Record updated successfully!', 'success');
                editIndex = -1;
            } else {
                records.push(record);
                showAlert('Record added successfully!', 'success');
            }

            saveData();
            resetForm();
            updateDashboard();
            switchTab('dashboard');
        });

        // Save and add new
        function saveAndNew() {
            document.getElementById('financeForm').dispatchEvent(new Event('submit'));
            setTimeout(() => {
                if (records.length > 0) {
                    resetForm();
                }
            }, 500);
        }

        // Reset form
        function resetForm() {
            document.getElementById('financeForm').reset();
            document.getElementById('billDate').valueAsDate = new Date();
            editIndex = -1;
            calculateTDS();
        }

        // Save to localStorage
        function saveData() {
            localStorage.setItem('financeRecords', JSON.stringify(records));
            localStorage.setItem('lastUpdate', new Date().toISOString());
        }

        // Update dashboard
        function updateDashboard() {
            const totalBills = records.reduce((sum, r) => sum + r.billAmount, 0);
            const totalPaid = records.reduce((sum, r) => sum + r.paidTillDate, 0);
            const outstanding = records.reduce((sum, r) => sum + r.balanceToPay, 0);

            document.getElementById('totalBillsAmount').textContent = formatCurrency(totalBills);
            document.getElementById('totalPaidAmount').textContent = formatCurrency(totalPaid);
            document.getElementById('outstandingAmount').textContent = formatCurrency(outstanding);
            document.getElementById('totalRecordsCount').textContent = records.length;

            // Recent transactions
            const recent = records.slice(-10).reverse();
            const tbody = document.getElementById('recentTable');

            if (recent.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--text-light); padding: 40px;">No records yet. Click "Add New" to create your first record.</td></tr>';
            } else {
                tbody.innerHTML = recent.map(r => `
                    <tr>
                        <td>${r.partyName}</td>
                        <td>${r.workDone}</td>
                        <td>${formatCurrency(r.billAmount)}</td>
                        <td>${formatCurrency(r.paidTillDate)}</td>
                        <td>${formatCurrency(r.balanceToPay)}</td>
                        <td>${getStatusBadge(r)}</td>
                        <td>${r.dueDate || 'N/A'}</td>
                    </tr>
                `).join('');
            }
        }

        // Display all records
        function displayRecords() {
            const tbody = document.getElementById('recordsTable');

            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" style="text-align: center; color: var(--text-light); padding: 40px;">No records available</td></tr>';
            } else {
                tbody.innerHTML = records.map((r, i) => `
                    <tr>
                        <td>${i + 1}</td>
                        <td>${r.partyName}</td>
                        <td>${r.workDone}</td>
                        <td>${r.billDate}</td>
                        <td>${formatCurrency(r.billAmount)}</td>
                        <td>${formatCurrency(r.paidTillDate)}</td>
                        <td>${formatCurrency(r.balanceToPay)}</td>
                        <td>${r.dueDate || 'N/A'}</td>
                        <td>${r.category}</td>
                        <td>${getStatusBadge(r)}</td>
                        <td>
                            <button class="action-btn edit" onclick="editRecord(${i})"><i class="fas fa-edit"></i> Edit</button>
                            <button class="action-btn delete" onclick="deleteRecord(${i})"><i class="fas fa-trash"></i> Delete</button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Edit record
        function editRecord(index) {
            const r = records[index];
            editIndex = index;

            document.getElementById('partyName').value = r.partyName;
            document.getElementById('workDone').value = r.workDone;
            document.getElementById('billDate').value = r.billDate;
            document.getElementById('billAmount').value = r.billAmount;
            document.getElementById('tdsRate').value = r.tdsRate;
            document.getElementById('totalPayable').value = r.totalPayable;
            document.getElementById('paidTillDate').value = r.paidTillDate;
            document.getElementById('paymentDate').value = r.paymentDate;
            document.getElementById('balanceToPay').value = r.balanceToPay;
            document.getElementById('paidInJan').value = r.paidInJan;
            document.getElementById('dueDate').value = r.dueDate;
            document.getElementById('category').value = r.category;

            calculateTDS();
            switchTab('add');
        }

        // Delete record
        function deleteRecord(index) {
            if (confirm('Are you sure you want to delete this record?')) {
                records.splice(index, 1);
                saveData();
                displayRecords();
                updateDashboard();
                showAlert('Record deleted successfully!', 'success');
            }
        }

        // Filter table
        function filterTable() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            const status = document.getElementById('statusFilter').value;

            let filtered = records.filter(r => {
                const matchSearch = r.partyName.toLowerCase().includes(search) || 
                                  r.workDone.toLowerCase().includes(search) ||
                                  r.billAmount.toString().includes(search);
                const matchCategory = !category || r.category === category;
                const matchStatus = !status || 
                    (status === 'paid' && r.balanceToPay === 0) ||
                    (status === 'partial' && r.paidTillDate > 0 && r.balanceToPay > 0) ||
                    (status === 'unpaid' && r.paidTillDate === 0);

                return matchSearch && matchCategory && matchStatus;
            });

            const tbody = document.getElementById('recordsTable');
            tbody.innerHTML = filtered.map((r, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>${r.partyName}</td>
                    <td>${r.workDone}</td>
                    <td>${r.billDate}</td>
                    <td>${formatCurrency(r.billAmount)}</td>
                    <td>${formatCurrency(r.paidTillDate)}</td>
                    <td>${formatCurrency(r.balanceToPay)}</td>
                    <td>${r.dueDate || 'N/A'}</td>
                    <td>${r.category}</td>
                    <td>${getStatusBadge(r)}</td>
                    <td>
                        <button class="action-btn edit" onclick="editRecord(${records.indexOf(r)})"><i class="fas fa-edit"></i> Edit</button>
                        <button class="action-btn delete" onclick="deleteRecord(${records.indexOf(r)})"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        // Clear filters
        function clearAllFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('statusFilter').value = '';
            displayRecords();
        }

        // Export to Excel
        function exportToExcel() {
            const ws = XLSX.utils.json_to_sheet(records);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Finance Records");
            XLSX.writeFile(wb, `HEMA_Finance_Report_${new Date().toISOString().split('T')[0]}.xlsx`);
            showAlert('Data exported to Excel successfully!', 'success');
        }

        // Export to CSV
        function exportToCSV() {
            const ws = XLSX.utils.json_to_sheet(records);
            const csv = XLSX.utils.sheet_to_csv(ws);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `HEMA_Finance_Report_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            showAlert('Data exported to CSV successfully!', 'success');
        }

        // Print
        function printData() {
            window.print();
        }

        // Clear all records
        function clearAllRecords() {
            if (confirm('⚠️ This will permanently delete ALL records. Are you sure?')) {
                if (confirm('This action cannot be undone. Continue?')) {
                    records = [];
                    saveData();
                    updateDashboard();
                    displayRecords();
                    updateStats();
                    showAlert('All records cleared!', 'success');
                }
            }
        }

        // Import file
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(sheet);

                    const imported = jsonData.map(row => ({
                        id: Date.now() + Math.random(),
                        partyName: row['Party Name'] || row['partyName'] || '',
                        workDone: row['Work Done'] || row['workDone'] || '',
                        billDate: row['Bill Date'] || row['billDate'] || '',
                        billAmount: parseFloat(row['Overall Bill Amt.'] || row['billAmount']) || 0,
                        tdsRate: 0,
                        totalPayable: parseFloat(row['Total Payable'] || row['totalPayable']) || 0,
                        paidTillDate: parseFloat(row['Total Paid Till Date'] || row['paidTillDate']) || 0,
                        paymentDate: row['Payment Date'] || row['paymentDate'] || '',
                        balanceToPay: parseFloat(row['Balance to be paid'] || row['balanceToPay']) || 0,
                        paidInJan: parseFloat(row['Paid in Jan'] || row['paidInJan']) || 0,
                        dueDate: row['Due Date'] || row['dueDate'] || '',
                        category: 'Other',
                        timestamp: new Date().toISOString()
                    }));

                    records = [...records, ...imported];
                    saveData();
                    updateDashboard();
                    displayRecords();
                    updateStats();
                    showAlert(`Successfully imported ${imported.length} records!`, 'success');
                } catch (error) {
                    showAlert('Error importing file. Please check format.', 'danger');
                    console.error(error);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Update stats
        function updateStats() {
            document.getElementById('statsRecords').textContent = records.length;
            const lastUpdate = localStorage.getItem('lastUpdate');
            document.getElementById('statsLastUpdate').textContent = lastUpdate ? 
                new Date(lastUpdate).toLocaleString('en-IN') : 'Never';
            const size = new Blob([JSON.stringify(records)]).size / 1024;
            document.getElementById('statsDataSize').textContent = size.toFixed(2) + ' KB';
        }

        // Utility functions
        function formatCurrency(amount) {
            return '₹' + amount.toLocaleString('en-IN', { maximumFractionDigits: 2, minimumFractionDigits: 2 });
        }

        function getStatusBadge(record) {
            if (record.balanceToPay === 0) {
                return '<span class="badge badge-success">Paid</span>';
            } else if (record.paidTillDate > 0) {
                return '<span class="badge badge-warning">Partial</span>';
            } else {
                return '<span class="badge badge-danger">Unpaid</span>';
            }
        }

        function showAlert(message, type) {
            const alert = document.getElementById('alertBox');
            alert.textContent = message;
            alert.className = `alert alert-${type} show`;
            setTimeout(() => alert.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>